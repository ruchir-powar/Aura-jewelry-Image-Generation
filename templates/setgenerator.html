{% extends "base.html" %}
{% block title %}Set Generator{% endblock %}
{% block content %}

<style>
  .container { max-width:900px; margin:0 auto; padding:20px; }
  h1 { font-size:28px; margin-bottom:6px; color:#1e1e1e; }
  .muted { color:#555; margin-bottom:20px; }

  .card {
    background:#fff; border:1px solid #e6e6e6; border-radius:12px;
    padding:18px 20px; margin-bottom:18px;
    box-shadow:0 4px 10px rgba(0,0,0,.04);
  }
  .card h3 { margin:0 0 14px; font-size:18px; color:#2a2a2a; font-weight:700; }

  .row { margin-bottom:14px; }
  label { font-weight:600; display:block; margin-bottom:6px; }

  /* --- PRETTY THEME INPUT --- */
  .theme-input{
    width:100%;
    padding:14px 16px;
    border:1px solid #e7e7eb;
    border-radius:14px;
    background:linear-gradient(180deg,#ffffff 0%,#fffdf8 100%);
    box-shadow:inset 0 1px 0 rgba(255,255,255,.9), 0 1px 2px rgba(0,0,0,.03);
    font-size:16px;
    color:#1f2937;
    outline:none;
    transition:border-color .18s ease, box-shadow .18s ease, background .18s ease;
  }
  .theme-input::placeholder{ color:#9aa1a9; font-style:italic; }
  .theme-input:focus{
    border-color:#ffd54a;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.95), 0 2px 10px rgba(255,213,0,.10), 0 0 0 4px rgba(255,213,0,.18);
    background:#fffef8;
  }
  .field-help{ font-size:12.5px; color:#6b7280; margin-top:6px; }

  /* --- CUSTOM FILE UPLOAD --- */
  .file-upload {
    display:flex; align-items:center; gap:12px;
  }
  .file-upload input[type="file"] {
    display:none;
  }
  .file-upload label {
    background:#ffd54a;
    color:#222;
    font-weight:600;
    padding:10px 18px;
    border-radius:10px;
    cursor:pointer;
    font-size:14px;
    box-shadow:0 2px 6px rgba(0,0,0,.15);
    transition:all 0.2s ease;
  }
  .file-upload label:hover {
    filter:brightness(0.97);
  }
  .file-upload span {
    font-size:14px;
    color:#555;
  }

  /* toggles */
  .grid-3 { display:grid; grid-template-columns:repeat(3,1fr); gap:14px; }
  .toggle {
    display:flex; align-items:center; justify-content:space-between;
    background:#fafafa; border:1px solid #ddd; border-radius:10px;
    padding:10px 14px; font-weight:600; cursor:pointer;
  }
  .toggle input { display:none; }
  .slider {
    width:42px; height:22px; background:#ccc; border-radius:22px;
    position:relative; transition:background .2s; flex-shrink:0;
  }
  .slider::before {
    content:""; position:absolute; top:3px; left:3px;
    width:16px; height:16px; background:#fff; border-radius:50%;
    transition:transform .2s;
  }
  .toggle input:checked + .slider { background:#ffd54a; }
  .toggle input:checked + .slider::before { transform:translateX(20px); }

  .actions { margin:20px 0; text-align:center; }
  .actions button {
    background:#ffd54a; border:none; color:#222; font-weight:700;
    padding:12px 22px; border-radius:10px; cursor:pointer;
    box-shadow:0 2px 6px rgba(0,0,0,.15); font-size:15px;
  }
  .actions button:hover { filter:brightness(0.97); }

  /* results grid */
  #setResults {
    display:grid; grid-template-columns:repeat(3,1fr);
    gap:16px; margin-top:20px;
  }
  .piece-card {
    border:1px solid #ddd; border-radius:12px; padding:12px;
    background:#fff; box-shadow:0 2px 6px rgba(0,0,0,.04);
    min-height:220px; display:flex; flex-direction:column; justify-content:center; align-items:center;
  }
  .piece-card img { max-width:100%; border-radius:10px; }
  .piece-card .label { margin-top:8px; font-size:14px; font-weight:600; }

  @keyframes spin{to{transform:rotate(360deg)}}
  .spinner{width:34px;height:34px;border-radius:50%;
    border:3px solid #f5e1a4;border-top-color:#f0c52b;
    animation:spin .8s linear infinite;}
</style>

<section class="container">
  <h1>Set Generator</h1>
  <p class="muted">Describe your design theme, optionally upload a reference image, then select pieces to include. Click <b>Generate Set</b> and images will appear below.</p>

  <form id="setForm" enctype="multipart/form-data">
    <!-- Theme / Motif -->
    <div class="card">
      <h3>1) Theme / Motif</h3>

      <div class="row">
        <label for="setTheme">Describe the theme</label>
        <input
          type="text"
          id="setTheme"
          name="theme"
          class="theme-input"
          placeholder="e.g., floral lattice with pavé diamonds"
          required
        />
        <div class="field-help">Keep it short and specific — we’ll build the rendering prompt around this.</div>
      </div>

      <div class="row">
        <label for="setRef">Reference Image (optional)</label>
        <div class="file-upload">
          <label for="setRef">Choose File</label>
          <input type="file" id="setRef" name="ref_image" accept="image/*" />
          <span id="fileName">No file chosen</span>
        </div>
      </div>
    </div>

    <!-- Pieces -->
    <div class="card">
      <h3>2) Pieces to Include</h3>
      <div class="grid-3">
        <label class="toggle">Necklace
          <input type="checkbox" name="pieces" value="necklace">
          <span class="slider"></span>
        </label>
        <label class="toggle">Earrings
          <input type="checkbox" name="pieces" value="earrings">
          <span class="slider"></span>
        </label>
        <label class="toggle">Ring
          <input type="checkbox" name="pieces" value="ring">
          <span class="slider"></span>
        </label>
        <label class="toggle">Bangle
          <input type="checkbox" name="pieces" value="bangle">
          <span class="slider"></span>
        </label>
        <label class="toggle">Bracelet
          <input type="checkbox" name="pieces" value="bracelet">
          <span class="slider"></span>
        </label>
        <label class="toggle">Pendant
          <input type="checkbox" name="pieces" value="pendant">
          <span class="slider"></span>
        </label>
      </div>
    </div>

    <!-- Action -->
    <div class="actions">
      <button id="btnGenerateSet" type="submit">Generate Set</button>
    </div>
  </form>

  <hr>

  <!-- Results -->
  <h3>Set Preview</h3>
  <div id="setResults"></div>
</section>

<script>
  // Show selected file name next to custom button
  const setRef = document.getElementById("setRef");
  const fileName = document.getElementById("fileName");
  setRef?.addEventListener("change", () => {
    fileName.textContent = setRef.files.length ? setRef.files[0].name : "No file chosen";
  });
</script>

{% endblock %}

{% block scripts %}
<script type="module" src="/static/js/pages/setPage.js"></script>
{% endblock %}
